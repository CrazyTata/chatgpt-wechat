/*! 
 Build based on chatgpt-wechat-admin 
 Time : 1685686675000 */
import{r as a,R as e,o as t,c as l,b as o,d as i,w as s,g as n,t as r,G as p,O as m,i as u,j as c,E as d,aA as g}from"./index-c0e4adfc.js";/* empty css                */import{E as f}from"./pagination-6acfc931.js";/* empty css              */import"./tag-06e34f44.js";import"./select-51c947b5.js";import"./scrollbar-83387f5b.js";/* empty css               */import{E as v,a as j}from"./table-column-ce61bdda.js";import"./checkbox-4e2047b2.js";/* empty css                */import{a as h,E as w}from"./form-item-2334633e.js";/* empty css               */import{_ as y,U as _,g as b,d as x,e as C}from"./common-4a509d62.js";import{C as k}from"./index-7e45dc2e.js";import{f as E}from"./format-d58b80c9.js";import{W as U}from"./warningBar-8f954f09.js";import{_ as z}from"./_plugin-vue_export-helper-1b428a4d.js";import{E as O}from"./index-6f1ff6e5.js";import"./isEqual-b7679b47.js";import"./_Uint8Array-51a2700d.js";import"./index-3aa8858d.js";import"./strings-df073129.js";import"./_initCloneObject-fdddb50e.js";import"./_baseClone-8e8c462c.js";import"./upload-5f8808c0.js";import"./progress-28e1bd53.js";import"./cloneDeep-fb8e8db9.js";import"./date-225eaf4f.js";import"./dictionary-8715b49d.js";import"./sysDictionary-fa38e7c5.js";/* empty css             */const A=(a,e)=>{var t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){var a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0,t.width,t.height);var l=a.toDataURL("image/png"),o=document.createElement("a"),i=new MouseEvent("click");o.download=e||"photo",o.href=l,o.dispatchEvent(i)},t.src=a},B={class:"gva-table-box"},S={class:"gva-btn-list"},V=["onClick"],D={class:"gva-pagination"},T={name:"Upload"},I=z(Object.assign(T,{setup(z){const T=a("/api"),I=a(""),F=a(""),L=a(1),M=a(0),R=a(10),W=a({}),q=a([]),G=a=>{R.value=a,X()},P=a=>{L.value=a,X()},X=async()=>{const a=await b({page:L.value,pageSize:R.value,...W.value});0===a.code&&(q.value=a.data.list,M.value=a.data.total,L.value=a.data.page,R.value=a.data.pageSize)};X();return(a,b)=>{const z=c,Y=h,Z=d,$=w,H=v,J=O,K=j,N=f,Q=g;return e((t(),l("div",null,[o("div",B,[i(U,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),o("div",S,[i(y,{imageCommon:F.value,"onUpdate:imageCommon":b[0]||(b[0]=a=>F.value=a),class:"upload-btn",onOnSuccess:X},null,8,["imageCommon"]),i(_,{imageUrl:I.value,"onUpdate:imageUrl":b[1]||(b[1]=a=>I.value=a),"file-size":512,"max-w-h":1080,class:"upload-btn",onOnSuccess:X},null,8,["imageUrl"]),i($,{ref:"searchForm",inline:!0,model:W.value},{default:s((()=>[i(Y,{label:""},{default:s((()=>[i(z,{modelValue:W.value.keyword,"onUpdate:modelValue":b[2]||(b[2]=a=>W.value.keyword=a),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),i(Y,null,{default:s((()=>[i(Z,{type:"primary",icon:"search",onClick:X},{default:s((()=>[n("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),i(K,{data:q.value},{default:s((()=>[i(H,{align:"left",label:"预览",width:"100"},{default:s((a=>[i(k,{"pic-type":"file","pic-src":a.row.url},null,8,["pic-src"])])),_:1}),i(H,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:s((a=>[o("div",null,r(p(E)(a.row.UpdatedAt)),1)])),_:1}),i(H,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:s((a=>[o("div",{class:"name",onClick:e=>(async a=>{m.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:a.name}).then((async({value:e})=>{a.name=e,0===(await C(a)).code&&(u({type:"success",message:"编辑成功!"}),X())})).catch((()=>{u({type:"info",message:"取消修改"})}))})(a.row)},r(a.row.name),9,V)])),_:1}),i(H,{align:"left",label:"链接",prop:"url","min-width":"300"}),i(H,{align:"left",label:"标签",prop:"tag",width:"100"},{default:s((a=>[i(J,{type:"jpg"===a.row.tag?"primary":"success","disable-transitions":""},{default:s((()=>[n(r(a.row.tag),1)])),_:2},1032,["type"])])),_:1}),i(H,{align:"left",label:"操作",width:"160"},{default:s((a=>[i(Z,{icon:"download",type:"primary",link:"",onClick:e=>{var t;(t=a.row).url.indexOf("http://")>-1||t.url.indexOf("https://")>-1?A(t.url,t.name):A(T.value+"/"+t.url,t.name)}},{default:s((()=>[n("下载")])),_:2},1032,["onClick"]),i(Z,{icon:"delete",type:"primary",link:"",onClick:e=>(async a=>{m.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await x(a)).code&&(u({type:"success",message:"删除成功!"}),1===q.value.length&&L.value>1&&L.value--,X())})).catch((()=>{u({type:"info",message:"已取消删除"})}))})(a.row)},{default:s((()=>[n("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",D,[i(N,{"current-page":L.value,"page-size":R.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:M.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:P,onSizeChange:G},null,8,["current-page","page-size","total"])])])])),[[Q,a.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-96830493"]]);export{I as default};
