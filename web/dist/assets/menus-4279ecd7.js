/*! 
 Build based on chatgpt-wechat-admin 
 Time : 1685686675000 */
import{r as e,a4 as a,o as t,c as o,b as s,d as l,w as r,g as n,t as u,H as i,e as d,cS as c,cT as m,i as p,cU as y,a5 as f,j as h,E as v}from"./index-c0e4adfc.js";import{E as j}from"./dialog-24cefcc5.js";import"./overlay-0e3768b7.js";import{E as k,a as w}from"./table-column-ce61bdda.js";import"./checkbox-4e2047b2.js";import"./tag-06e34f44.js";/* empty css                *//* empty css               */import"./scrollbar-83387f5b.js";import{E as I}from"./tree-592694ed.js";/* empty css               *//* empty css              */import{u as g}from"./authority-1e864ce3.js";import{g as b,s as _}from"./authorityBtn-5a2b0847.js";import{_ as C}from"./_plugin-vue_export-helper-1b428a4d.js";import"./index-3aa8858d.js";import"./_Uint8Array-51a2700d.js";import"./_initCloneObject-fdddb50e.js";import"./isEqual-b7679b47.js";import"./index-e6ea490b.js";const x={class:"clearfix sticky-button"},R={class:"tree-content"},E={class:"custom-tree-node"},D={key:0},V={class:"dialog-footer"},N={name:"Menus"},O=C(Object.assign(N,{props:{row:{default:function(){return{}},type:Object}},emits:["changeRow"],setup(C,{expose:N,emit:O}){const A=C,U=e(""),B=e([]),S=e([]),T=e(!1),H=e({children:"children",label:function(e){return e.meta.title}});(async()=>{const e=await c();B.value=e.data.menus;const a=(await m({authorityId:A.row.authorityId})).data.menus,t=[];a.forEach((e=>{a.some((a=>a.parentId===e.menuId))||t.push(Number(e.menuId))})),S.value=t})();const q=()=>{T.value=!0},M=e(null),Q=async()=>{const e=M.value.getCheckedNodes(!1,!0);0===(await y({menus:e,authorityId:A.row.authorityId})).code&&p({type:"success",message:"菜单设置成功!"})};N({enterAndNext:()=>{Q()},needConfirm:T});const W=e(!1),X=e([]),Z=e([]),$=e();let z="";const F=e=>{Z.value=e},G=e=>{W.value=!0,X.value=e.menuBtn},J=()=>{W.value=!1},K=async()=>{const e=Z.value.map((e=>e.ID));0===(await _({menuID:z,selected:e,authorityId:A.row.authorityId})).code&&(p({type:"success",message:"设置成功"}),W.value=!1)},L=(e,a)=>!e||-1!==a.meta.title.indexOf(e);return a(U,(e=>{M.value.filter(e)})),(e,a)=>{const c=h,m=v,y=I,_=k,N=w,T=j;return t(),o("div",null,[s("div",x,[l(c,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),class:"fitler",placeholder:"筛选"},null,8,["modelValue"]),l(m,{class:"fl-right",type:"primary",onClick:Q},{default:r((()=>[n("确 定")])),_:1})]),s("div",R,[l(y,{ref_key:"menuTree",ref:M,data:B.value,"default-checked-keys":S.value,props:H.value,"default-expand-all":"","highlight-current":"","node-key":"ID","show-checkbox":"","filter-node-method":L,onCheck:q},{default:r((({node:e,data:a})=>[s("span",E,[s("span",null,u(e.label),1),s("span",null,[l(m,{type:"primary",link:"",style:i({color:C.row.defaultRouter===a.name?"#E6A23C":"#85ce61"}),disabled:!e.checked,onClick:()=>(async e=>{const a=await g({authorityId:A.row.authorityId,AuthorityName:A.row.authorityName,parentId:A.row.parentId,defaultRouter:e.name});0===a.code&&(p({type:"success",message:"设置成功"}),O("changeRow","defaultRouter",a.data.authority.defaultRouter))})(a)},{default:r((()=>[n(u(C.row.defaultRouter===a.name?"首页":"设为首页"),1)])),_:2},1032,["style","disabled","onClick"])]),a.menuBtn.length?(t(),o("span",D,[l(m,{type:"primary",link:"",onClick:()=>(async e=>{z=e.ID;const a=await b({menuID:z,authorityId:A.row.authorityId});0===a.code&&(G(e),await f(),a.data.selected&&a.data.selected.forEach((e=>{X.value.some((a=>{a.ID===e&&$.value.toggleRowSelection(a,!0)}))})))})(a)},{default:r((()=>[n(" 分配按钮 ")])),_:2},1032,["onClick"])])):d("",!0)])])),_:1},8,["data","default-checked-keys","props"])]),l(T,{modelValue:W.value,"onUpdate:modelValue":a[1]||(a[1]=e=>W.value=e),title:"分配按钮","destroy-on-close":""},{footer:r((()=>[s("div",V,[l(m,{onClick:J},{default:r((()=>[n("取 消")])),_:1}),l(m,{type:"primary",onClick:K},{default:r((()=>[n("确 定")])),_:1})])])),default:r((()=>[l(N,{ref_key:"btnTableRef",ref:$,data:X.value,"row-key":"ID",onSelectionChange:F},{default:r((()=>[l(_,{type:"selection",width:"55"}),l(_,{label:"按钮名称",prop:"name"}),l(_,{label:"按钮备注",prop:"desc"})])),_:1},8,["data"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-d1e06e89"]]);export{O as default};
