/*! 
 Build based on chatgpt-wechat-admin 
 Time : 1685686675000 */
import{r as e,o as a,c as l,b as t,d as o,w as u,M as i,N as s,p as r,g as p,t as d,i as n,O as m,j as c,E as v,q as f,s as g}from"./index-c0e4adfc.js";import{E as b}from"./dialog-24cefcc5.js";import"./overlay-0e3768b7.js";import{E as h}from"./pagination-6acfc931.js";/* empty css              */import"./tag-06e34f44.js";import{E as y,a as _}from"./select-51c947b5.js";import"./scrollbar-83387f5b.js";/* empty css               */import{E as j,a as w}from"./table-column-ce61bdda.js";import"./checkbox-4e2047b2.js";/* empty css                */import{E as V}from"./popover-3969edac.js";import{a as k,E as C}from"./form-item-2334633e.js";/* empty css               */import{g as x,d as A,a as E,u as U,c as G,b as I}from"./api-8a67aa3c.js";import{t as z}from"./stringFun-647a78e9.js";import{W as P}from"./warningBar-8f954f09.js";import{_ as q}from"./_plugin-vue_export-helper-1b428a4d.js";import"./isEqual-b7679b47.js";import"./_Uint8Array-51a2700d.js";import"./index-3aa8858d.js";import"./index-6f1ff6e5.js";import"./strings-df073129.js";import"./_initCloneObject-fdddb50e.js";import"./dropdown-17261785.js";import"./_baseClone-8e8c462c.js";/* empty css             */const S={class:"gva-search-box"},T={class:"gva-table-box"},$={class:"gva-btn-list"},D=(e=>(f("data-v-bcd8c4e1"),e=e(),g(),e))((()=>t("p",null,"确定要删除吗？",-1))),F={style:{"text-align":"right","margin-top":"8px"}},O={class:"gva-pagination"},B={class:"dialog-footer"},L={name:"Api"},M=q(Object.assign(L,{setup(f){const g=e=>{const a=M.value.filter((a=>a.value===e))[0];return a&&`${a.label}`},q=e([]),L=e({path:"",apiGroup:"",method:"",description:""}),M=e([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),W=e(""),K=e({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),N=e(1),X=e(0),Y=e(10),Z=e([]),H=e({}),J=()=>{H.value={}},Q=()=>{N.value=1,Y.value=10,le()},R=e=>{Y.value=e,le()},ee=e=>{N.value=e,le()},ae=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),H.value.orderKey=z(e),H.value.desc="descending"===a),le()},le=async()=>{const e=await x({page:N.value,pageSize:Y.value,...H.value});0===e.code&&(Z.value=e.data.list,X.value=e.data.total,N.value=e.data.page,Y.value=e.data.pageSize)};le();const te=e=>{q.value=e},oe=e(!1),ue=async()=>{const e=q.value.map((e=>e.ID)),a=await A({ids:e});0===a.code&&(n({type:"success",message:a.msg}),Z.value.length===e.length&&N.value>1&&N.value--,oe.value=!1,le())},ie=e(null),se=e("新增Api"),re=e(!1),pe=e=>{switch(e){case"addApi":se.value="新增Api";break;case"edit":se.value="编辑Api"}W.value=e,re.value=!0},de=()=>{ie.value.resetFields(),L.value={path:"",apiGroup:"",method:"",description:""},re.value=!1},ne=async()=>{ie.value.validate((async e=>{if(e)switch(W.value){case"addApi":0===(await G(L.value)).code&&n({type:"success",message:"添加成功",showClose:!0}),le(),de();break;case"edit":0===(await U(L.value)).code&&n({type:"success",message:"编辑成功",showClose:!0}),le(),de();break;default:n({type:"error",message:"未知操作",showClose:!0})}}))};return(e,f)=>{const x=c,A=k,U=y,G=_,z=v,W=C,me=V,ce=j,ve=w,fe=h,ge=b;return a(),l("div",null,[t("div",S,[o(W,{ref:"searchForm",inline:!0,model:H.value},{default:u((()=>[o(A,{label:"路径"},{default:u((()=>[o(x,{modelValue:H.value.path,"onUpdate:modelValue":f[0]||(f[0]=e=>H.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),o(A,{label:"描述"},{default:u((()=>[o(x,{modelValue:H.value.description,"onUpdate:modelValue":f[1]||(f[1]=e=>H.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),o(A,{label:"API组"},{default:u((()=>[o(x,{modelValue:H.value.apiGroup,"onUpdate:modelValue":f[2]||(f[2]=e=>H.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),o(A,{label:"请求"},{default:u((()=>[o(G,{modelValue:H.value.method,"onUpdate:modelValue":f[3]||(f[3]=e=>H.value.method=e),clearable:"",placeholder:"请选择"},{default:u((()=>[(a(!0),l(i,null,s(M.value,(e=>(a(),r(U,{key:e.value,label:`${e.label}(${e.value})`,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(A,null,{default:u((()=>[o(z,{type:"primary",icon:"search",onClick:Q},{default:u((()=>[p("查询")])),_:1}),o(z,{icon:"refresh",onClick:J},{default:u((()=>[p("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),t("div",T,[t("div",$,[o(z,{type:"primary",icon:"plus",onClick:f[4]||(f[4]=e=>pe("addApi"))},{default:u((()=>[p("新增")])),_:1}),o(me,{modelValue:oe.value,"onUpdate:modelValue":f[7]||(f[7]=e=>oe.value=e),placement:"top",width:"160"},{reference:u((()=>[o(z,{icon:"delete",disabled:!q.value.length,style:{"margin-left":"10px"},onClick:f[6]||(f[6]=e=>oe.value=!0)},{default:u((()=>[p("删除")])),_:1},8,["disabled"])])),default:u((()=>[D,t("div",F,[o(z,{type:"primary",link:"",onClick:f[5]||(f[5]=e=>oe.value=!1)},{default:u((()=>[p("取消")])),_:1}),o(z,{type:"primary",onClick:ue},{default:u((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"])]),o(ve,{data:Z.value,onSortChange:ae,onSelectionChange:te},{default:u((()=>[o(ce,{type:"selection",width:"55"}),o(ce,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),o(ce,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),o(ce,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),o(ce,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),o(ce,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:u((e=>[t("div",null,d(e.row.method)+" / "+d(g(e.row.method)),1)])),_:1}),o(ce,{align:"left",fixed:"right",label:"操作",width:"200"},{default:u((e=>[o(z,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await E({id:e.ID});L.value=a.data.api,pe("edit")})(e.row)},{default:u((()=>[p("编辑")])),_:2},1032,["onClick"]),o(z,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{m.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await I(e)).code&&(n({type:"success",message:"删除成功!"}),1===Z.value.length&&N.value>1&&N.value--,le())}))})(e.row)},{default:u((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),t("div",O,[o(fe,{"current-page":N.value,"page-size":Y.value,"page-sizes":[10,30,50,100],total:X.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:ee,onSizeChange:R},null,8,["current-page","page-size","total"])])]),o(ge,{modelValue:re.value,"onUpdate:modelValue":f[12]||(f[12]=e=>re.value=e),"before-close":de,title:se.value},{footer:u((()=>[t("div",B,[o(z,{onClick:de},{default:u((()=>[p("取 消")])),_:1}),o(z,{type:"primary",onClick:ne},{default:u((()=>[p("确 定")])),_:1})])])),default:u((()=>[o(P,{title:"新增API，需要在角色管理内配置权限才可使用"}),o(W,{ref_key:"apiForm",ref:ie,model:L.value,rules:K.value,"label-width":"80px"},{default:u((()=>[o(A,{label:"路径",prop:"path"},{default:u((()=>[o(x,{modelValue:L.value.path,"onUpdate:modelValue":f[8]||(f[8]=e=>L.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(A,{label:"请求",prop:"method"},{default:u((()=>[o(G,{modelValue:L.value.method,"onUpdate:modelValue":f[9]||(f[9]=e=>L.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:u((()=>[(a(!0),l(i,null,s(M.value,(e=>(a(),r(U,{key:e.value,label:`${e.label}(${e.value})`,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(A,{label:"api分组",prop:"apiGroup"},{default:u((()=>[o(x,{modelValue:L.value.apiGroup,"onUpdate:modelValue":f[10]||(f[10]=e=>L.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(A,{label:"api简介",prop:"description"},{default:u((()=>[o(x,{modelValue:L.value.description,"onUpdate:modelValue":f[11]||(f[11]=e=>L.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-bcd8c4e1"]]);export{M as default};
